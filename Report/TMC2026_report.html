<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <title>TRADES → Risk &amp; Architecture Report (offline)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{ --border:#d0d7de; --muted:#57606a; --bg:#fff; --chip:#eef2ff; --green:#a8e6a1; --yellow:#f9f48b; --orange:#f7b267; --red:#f25f5c; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;line-height:1.4;margin:24px;background:var(--bg)}
    h1,h2,h3{margin-top:1.1em}
    .bar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
    input[type=file]{padding:8px;border:1px solid var(--border);border-radius:6px}
    button{padding:8px 12px;border:1px solid var(--border);background:#f6f8fa;border-radius:6px;cursor:pointer}
    button:disabled{opacity:0.5;cursor:not-allowed}
    .sidenote{color:var(--muted);font-size:13px}
    .note{background:#fff8c5;border:1px solid #f0e6a1;padding:10px;border-radius:6px}
    .table{border-collapse:collapse;width:100%;}
    .table th,.table td{border:1px solid var(--border);padding:6px 8px;font-size:14px;vertical-align:top}
    .matrix{border-collapse:collapse}
    .matrix th,.matrix td{border:1px solid #aaa;padding:10px;text-align:left;vertical-align:top;width:160px;height:90px}
    .badge{display:inline-block;margin:2px;padding:2px 6px;background:var(--chip);border-radius:12px}
    ul.tree{list-style: none; padding-left: 0}
    ul.tree ul{list-style: none; padding-left: 16px; border-left:2px solid #e5e7eb; margin-left:6px}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px}
  </style>
</head>
<body>
<h1>TRADES → Risk &amp; Architecture Report</h1>
<p class="sidenote">This single HTML file runs locally in your browser. No data leaves your machine.</p>
<div class="bar">
  <input id="fileInput" type="file" accept=".trades,.xml,.xmi,.txt">
  <button id="parseBtn">Generate report</button>
  <button id="downloadBtn">Download this report (HTML)</button>
  <span id="status" class="sidenote">simcitybuildgame.trades loaded (54953 bytes)</span>
</div>
<div id="report"><div><section><h2>File Summary</h2><ul><li><strong>Name</strong>: simcitybuildgame.trades</li><li><strong>Size</strong>: 54953 bytes</li></ul><p class="note">If some sections appear empty, the XMI may not include those elements or uses a different mapping. Export the <em>.trades</em> with full semantic content.</p></section><section><h2>Identified Risks (Threat Allocations)</h2><table class="table"><thead><tr><th>Threat Allocation</th><th>Impact</th><th>Feasibility</th></tr></thead><tbody><tr><td>Tampering on Web Client (browser SPA)</td><td></td><td></td></tr><tr><td>Tampering with in-game values on Web Client (browser SPA)</td><td></td><td></td></tr><tr><td>Spoofing on API Gateway</td><td></td><td></td></tr><tr><td>Forged or stolen authentication tokens on API Gateway</td><td></td><td></td></tr><tr><td>Exploitation of Trusted Identifiers on API Gateway</td><td></td><td></td></tr><tr><td>IP spoofing to bypass rate limiting on API Gateway</td><td></td><td></td></tr><tr><td>User identity theft on User Profile Service + Storage</td><td>2 (Moderate (Moderate revenue loss / Partial service outage Limited non-sensitive user data exposure or unsafe environment for targeted users / Refunds/goodwill-credits / Customer churn (small scale) / Financial loss to participant limited to their game credit / Unpleasant atmosphere: non-inclusiveness))</td><td>2 (Possible)</td></tr><tr><td>Cross-Site WebSocket Hijacking (CSWSH) due to missing authentication. on Game Server Cluster (real-time backend)</td><td></td><td></td></tr><tr><td>Long-lived WebSockets due to insufficient logout methods on Game Server Cluster (real-time backend)</td><td></td><td></td></tr><tr><td>Use of unencrypted websockets protocol on Game Server Cluster (real-time backend)</td><td></td><td></td></tr><tr><td>Missing input validation on inputs passed along WebSockets on Game Server Cluster (real-time backend)</td><td>2 (Moderate (Moderate revenue loss / Partial service outage Limited non-sensitive user data exposure or unsafe environment for targeted users / Refunds/goodwill-credits / Customer churn (small scale) / Financial loss to participant limited to their game credit / Unpleasant atmosphere: non-inclusiveness))</td><td>2 (Possible)</td></tr><tr><td>Spoofing on Game Server Cluster (real-time backend)</td><td></td><td></td></tr><tr><td>Information Disclosure on Game Server Cluster (real-time backend)</td><td></td><td></td></tr><tr><td>Tampering on Game Server Cluster (real-time backend)</td><td></td><td></td></tr><tr><td>Spoofing on Chat Service (real-time)</td><td></td><td></td></tr><tr><td>Identity Spoofing on Chat Service (real-time)</td><td>3 (Major (Major revenue loss / Account compromise / Sensitive data exposure / Large player backlash / Brand damage / Prolonged service outage / Financial loss to participant beyond their game credit / Unsafe gaming atmosphere))</td><td>2 (Possible)</td></tr><tr><td>Tampering on Chat Service (real-time)</td><td></td><td></td></tr><tr><td>Cross-Site Scripting (XSS) on Chat Service (real-time)</td><td>3 (Major (Major revenue loss / Account compromise / Sensitive data exposure / Large player backlash / Brand damage / Prolonged service outage / Financial loss to participant beyond their game credit / Unsafe gaming atmosphere))</td><td>2 (Possible)</td></tr><tr><td>Repudiation on Chat Service (real-time)</td><td></td><td></td></tr><tr><td>Information Disclosure on Chat Service (real-time)</td><td></td><td></td></tr><tr><td>Gather Victim Identity Information on Chat Service (real-time)</td><td></td><td></td></tr><tr><td>Denial of Serivce on Chat Service (real-time)</td><td></td><td></td></tr><tr><td>Flooding on Chat Service (real-time)</td><td>1 (Minor (Minor revenue loss / Short service disruption / Cosmetic/gameplay bug abuse / No sensitive data exposed / Small support overhead))</td><td>3 (Likely)</td></tr><tr><td>Elevation of Privilege on Chat Service (real-time)</td><td>1 (Minor (Minor revenue loss / Short service disruption / Cosmetic/gameplay bug abuse / No sensitive data exposed / Small support overhead))</td><td>3 (Likely)</td></tr><tr><td>Functionality Misuse on Chat Service (real-time)</td><td>2 (Moderate (Moderate revenue loss / Partial service outage Limited non-sensitive user data exposure or unsafe environment for targeted users / Refunds/goodwill-credits / Customer churn (small scale) / Financial loss to participant limited to their game credit / Unpleasant atmosphere: non-inclusiveness))</td><td>3 (Likely)</td></tr><tr><td>Denial of Service on System</td><td>1 (Minor (Minor revenue loss / Short service disruption / Cosmetic/gameplay bug abuse / No sensitive data exposed / Small support overhead))</td><td>1 (Unlikely)</td></tr></tbody></table></section><section><h2>Impact Items</h2><table class="table"><thead><tr><th>Level</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td>Minor (Minor revenue loss / Short service disruption / Cosmetic/gameplay bug abuse / No sensitive data exposed / Small support overhead)</td></tr><tr><td>2</td><td>Moderate (Moderate revenue loss / Partial service outage Limited non-sensitive user data exposure or unsafe environment for targeted users / Refunds/goodwill-credits / Customer churn (small scale) / Financial loss to participant limited to their game credit / Unpleasant atmosphere: non-inclusiveness)</td></tr><tr><td>3</td><td>Major (Major revenue loss / Account compromise / Sensitive data exposure / Large player backlash / Brand damage / Prolonged service outage / Financial loss to participant beyond their game credit / Unsafe gaming atmosphere)</td></tr><tr><td>4</td><td>Severe (Significant revenue loss threatening the company’s existence / Identity theft / Large-scale personal data breach / Regulatory violation (GDPR-K) / Long-term loss of users and/or sponsors / Very Prolonged service outage / Loss of proprietary code &amp; IP / Extremely Unsafe gaming atmosphere, e.g harassment, fraud, illegal content)</td></tr></tbody></table></section><section><h2>Risk Matrix (Impact vs Feasibility)</h2><table class="matrix"><thead><tr><th></th><th>Feasibility 1 (Unlikely)</th><th>Feasibility 2 (Possible)</th><th>Feasibility 3 (Likely)</th><th>Feasibility 4 (Very Likely)</th></tr></thead><tbody><tr><th>Impact 1 (Minor (Minor revenue loss / Short service disruption / Cosmetic/gameplay bug abuse / No sensitive data exposed / Small support overhead))</th><td style="background: rgb(0, 255, 0);"><span class="badge">Tampering on Web Client (browser SPA)</span><span class="badge">Tampering with in-game values on Web Client (browser SPA)</span><span class="badge">Spoofing on API Gateway</span><span class="badge">Forged or stolen authentication tokens on API Gateway</span><span class="badge">Exploitation of Trusted Identifiers on API Gateway</span><span class="badge">IP spoofing to bypass rate limiting on API Gateway</span><span class="badge">Cross-Site WebSocket Hijacking (CSWSH) due to missing authentication. on Game Server Cluster (real-time backend)</span><span class="badge">Long-lived WebSockets due to insufficient logout methods on Game Server Cluster (real-time backend)</span><span class="badge">Use of unencrypted websockets protocol on Game Server Cluster (real-time backend)</span><span class="badge">Spoofing on Game Server Cluster (real-time backend)</span><span class="badge">Information Disclosure on Game Server Cluster (real-time backend)</span><span class="badge">Tampering on Game Server Cluster (real-time backend)</span><span class="badge">Spoofing on Chat Service (real-time)</span><span class="badge">Tampering on Chat Service (real-time)</span><span class="badge">Repudiation on Chat Service (real-time)</span><span class="badge">Information Disclosure on Chat Service (real-time)</span><span class="badge">Gather Victim Identity Information on Chat Service (real-time)</span><span class="badge">Denial of Serivce on Chat Service (real-time)</span><span class="badge">Denial of Service on System</span></td><td style="background: rgb(0, 255, 0);"></td><td style="background: rgb(0, 255, 0);"><span class="badge">Flooding on Chat Service (real-time)</span><span class="badge">Elevation of Privilege on Chat Service (real-time)</span></td><td style="background: rgb(0, 255, 0);"></td></tr><tr><th>Impact 2 (Moderate (Moderate revenue loss / Partial service outage Limited non-sensitive user data exposure or unsafe environment for targeted users / Refunds/goodwill-credits / Customer churn (small scale) / Financial loss to participant limited to their game credit / Unpleasant atmosphere: non-inclusiveness))</th><td style="background: rgb(0, 255, 0);"></td><td style="background: rgb(0, 255, 0);"><span class="badge">User identity theft on User Profile Service + Storage</span><span class="badge">Missing input validation on inputs passed along WebSockets on Game Server Cluster (real-time backend)</span></td><td style="background: rgb(0, 255, 0);"><span class="badge">Functionality Misuse on Chat Service (real-time)</span></td><td style="background: rgb(255, 255, 0);"></td></tr><tr><th>Impact 3 (Major (Major revenue loss / Account compromise / Sensitive data exposure / Large player backlash / Brand damage / Prolonged service outage / Financial loss to participant beyond their game credit / Unsafe gaming atmosphere))</th><td style="background: rgb(0, 255, 0);"></td><td style="background: rgb(255, 255, 0);"><span class="badge">Identity Spoofing on Chat Service (real-time)</span><span class="badge">Cross-Site Scripting (XSS) on Chat Service (real-time)</span></td><td style="background: rgb(255, 255, 0);"></td><td style="background: rgb(255, 0, 0);"></td></tr><tr><th>Impact 4 (Severe (Significant revenue loss threatening the company’s existence / Identity theft / Large-scale personal data breach / Regulatory violation (GDPR-K) / Long-term loss of users and/or sponsors / Very Prolonged service outage / Loss of proprietary code &amp; IP / Extremely Unsafe gaming atmosphere, e.g harassment, fraud, illegal content))</th><td style="background: rgb(0, 255, 0);"></td><td style="background: rgb(255, 255, 0);"></td><td style="background: rgb(255, 0, 0);"></td><td style="background: rgb(255, 0, 0);"></td></tr></tbody></table><p class="sidenote">Matrix size adapts to your scoring system: Impact levels 1…4 × Feasibility levels 1…4. Model-defined colors override the fallback gradient.</p></section><section><h2>System Architecture</h2><ul class="tree"><li><strong>System</strong><div class="sidenote">Controls: <span class="badge">Access Enforcement (external)</span> <span class="badge">Separate Test Environments (external)</span> <span class="badge">No Embedded Unencrypted Static Authenticators (external)</span></div><ul class="tree"><li><strong>Web Client (browser SPA)</strong></li><li><strong>API Gateway</strong><div class="sidenote">Controls: <span class="badge">Cryptographic Protection (external)</span> <span class="badge">Revocation of Access Authorizations (external)</span> <span class="badge">Session Authenticity (external)</span></div></li><li><strong>Auth Service (Identity)</strong><div class="sidenote">Controls: <span class="badge">Re-authentication (external)</span></div><ul class="tree"><li><strong>_store</strong></li></ul></li><li><strong>User Profile Service + Storage</strong></li><li><strong>Upload &amp; Media Service</strong><ul class="tree"><li><strong>Object Server</strong></li></ul></li><li><strong>Game Server Cluster (real-time backend)</strong><div class="sidenote">Controls: <span class="badge">Boundary Protection (external)</span> <span class="badge">Network Disconnect (external)</span> <span class="badge">Information Input Validation (external)</span></div></li><li><strong>Chat Service (real-time)</strong><div class="sidenote">Controls: <span class="badge">Throttling (internal)</span> <span class="badge">Identity Evidence Validation and Verification (external)</span> <span class="badge">Restrict Inputs to Trusted Sources and Approved Formats (external)</span> <span class="badge">Information Output Filtering (external)</span> <span class="badge">Capacity, Bandwidth, and Redundancy (external)</span> <span class="badge">Resource Availability (external)</span> <span class="badge">Role-based Access Control (?in Secrets Vault?) (external)</span></div></li><li><strong>Marketplace </strong></li><li><strong>Payment Service (External)</strong></li><li><strong>Moderation &amp; Admin Tools</strong></li><li><strong>Persistence &amp; Logging</strong></li><li><strong>CDN &amp; Asset Hosting</strong><div class="sidenote">Controls: <span class="badge">InternalControlExample (internal)</span></div></li><li><strong>Background Workers</strong></li><li><strong>DevOps / CI/CD </strong></li><li><strong>Secrets Vault</strong><div class="sidenote">Controls: <span class="badge">Role-based Access Control (external)</span></div></li></ul></li></ul></section><section><h2>Data Flows</h2><table class="table"><thead><tr><th>Link</th><th>Target Component</th><th>Data Refs</th></tr></thead><tbody><tr><td>TLS Connection</td><td>API Gateway</td><td>registration, login, profile edits, avatar uploads, chat messages (inputs), marketplace requests, game inputs <span class="sidenote">(//@components.0/@dataOwner/@data.0 //@components.0/@dataOwner/@data.1 //@components.0/@dataOwner/@data.2 //@components.0/@dataOwner/@data.3 //@components.0/@dataOwner/@data.4 //@components.0/@dataOwner/@data.5 //@components.0/@dataOwner/@data.6)</span></td></tr><tr><td></td><td>Upload &amp; Media Service</td><td>user images <span class="sidenote">(//@components.0/@dataOwner/@data.13)</span></td></tr><tr><td>TLS Connection</td><td>Web Client (browser SPA)</td><td>UI assets, game state deltas, chat messages (output), purchase confirmations, access token <span class="sidenote">(//@components.0/@dataOwner/@data.7 //@components.0/@dataOwner/@data.8 //@components.0/@dataOwner/@data.9 //@components.0/@dataOwner/@data.10 //@components.0/@dataOwner/@data.12)</span></td></tr><tr><td></td><td>Auth Service (Identity)</td><td>login <span class="sidenote">(//@components.0/@dataOwner/@data.1)</span></td></tr><tr><td></td><td>_store</td><td>hashedPasswords <span class="sidenote">(//@components.0/@dataOwner/@data.11)</span></td></tr><tr><td></td><td>Object Server</td><td>user images <span class="sidenote">(//@components.0/@dataOwner/@data.13)</span></td></tr><tr><td></td><td>API Gateway</td><td>game state deltas <span class="sidenote">(//@components.0/@dataOwner/@data.8)</span></td></tr><tr><td></td><td>Chat Service (real-time)</td><td>service originated messages <span class="sidenote">(//@components.0/@dataOwner/@data.14)</span></td></tr></tbody></table></section><section><h2>Allocated Security Controls</h2><h3>Catalog</h3><table class="table"><thead><tr><th>Control</th><th>Kind</th><th>ID</th><th>Source</th><th>Description</th></tr></thead><tbody><tr><td>Access Enforcement</td><td>external</td><td>ac-3</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td></td></tr><tr><td>Separate Test Environments</td><td>external</td><td>cm-4.1</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Separate development - including of third-party add ons - environments</td></tr><tr><td>No Embedded Unencrypted Static Authenticators</td><td>external</td><td>ia-5.7</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Ensure that unencrypted static authenticators are not embedded in applications or other forms of static storage.</td></tr><tr><td>Cryptographic Protection</td><td>external</td><td>si-7.6</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td></td></tr><tr><td>Revocation of Access Authorizations</td><td>external</td><td>ac-3.8</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Enforce the revocation of access authorizations resulting from changes to the security attributes of subjects and objects based on TBD.


Revocation of access rules may differ based on the types of access revoked. For example, if a subject (i.e., user or process acting on behalf of a user) is removed from a group, access may not be revoked until the next time the object is opened or the next time the subject attempts to access the object. Revocation based on changes to security labels may take effect immediately. Organizations provide alternative approaches on how to make revocations immediate if systems cannot provide such capability and immediate revocation is necessary.


</td></tr><tr><td>Session Authenticity</td><td>external</td><td>sc-23</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Protect the authenticity of communications sessions.</td></tr><tr><td>Re-authentication</td><td>external</td><td>ia-11</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Require users to re-authenticate when new game is created.


In addition to the re-authentication requirements associated with device locks, organizations may require re-authentication of individuals in certain situations, including when roles, authenticators or credentials change, when security categories of systems change, when the execution of privileged functions occurs, after a fixed time period, or periodically.


</td></tr><tr><td>Boundary Protection</td><td>external</td><td>sc-7</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Monitor and control communications at the external managed interfaces to the system and at key internal managed interfaces within the system;

Implement subnetworks for publicly accessible system components that are logically separated from internal organizational networks; and

Connect to external networks or systems only through managed interfaces consisting of boundary protection devices arranged in accordance with an organizational security and privacy architecture.


Managed interfaces include gateways, routers, firewalls, guards, network-based malicious code analysis, virtualization systems, or encrypted tunnels implemented within a security architecture. Subnetworks that are physically or logically separated from internal networks are referred to as demilitarized zones or DMZs. Restricting or prohibiting interfaces within organizational systems includes restricting external web traffic to designated web servers within managed interfaces, prohibiting external traffic that appears to be spoofing internal addresses, and prohibiting internal traffic that appears to be spoofing external addresses. [SP 800-189](#f5edfe51-d1f2-422e-9b27-5d0e90b49c72) provides additional information on source address validation techniques to prevent ingress and egress of traffic with spoofed addresses. Commercial telecommunications services are provided by network components and consolidated management systems shared by customers. These services may also include third party-provided access lines and other service elements. Such services may represent sources of increased risk despite contract security provisions. Boundary protection may be implemented as a common control for all or part of an organizational network such that the boundary to be protected is greater than a system-specific boundary (i.e., an authorization boundary).


</td></tr><tr><td>Network Disconnect</td><td>external</td><td>sc-10</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Terminate the network connection associated with a communications session at the end of the session or after TBD seconds of inactivity.


Network disconnect applies to internal and external networks. Terminating network connections associated with specific communications sessions includes de-allocating TCP/IP address or port pairs at the operating system level and de-allocating the networking assignments at the application level if multiple application sessions are using a single operating system-level network connection. Periods of inactivity may be established by organizations and include time periods by type of network access or for specific network accesses.


</td></tr><tr><td>Information Input Validation</td><td>external</td><td>si-10</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Check the validity of the following information inputs: user input in websockets.


Checking the valid syntax and semantics of system inputs—including character set, length, numerical range, and acceptable values—verifies that inputs match specified definitions for format and content. For example, if the organization specifies that numerical values between 1-100 are the only acceptable inputs for a field in a given application, inputs of "387,"
"abc," or "%K%" are invalid inputs and are not accepted as input to the system. Valid inputs are likely to vary from field to field within a software application. Applications typically follow well-defined protocols that use structured messages (i.e., commands or queries) to communicate between software modules or system components. Structured messages can contain raw or unstructured data interspersed with metadata or control information. If software applications use attacker-supplied inputs to construct structured messages without properly encoding such messages, then the attacker could insert malicious commands or special characters that can cause the data to be interpreted as control information or metadata. Consequently, the module or component that receives the corrupted output will perform the wrong operations or otherwise interpret the data incorrectly. Prescreening inputs prior to passing them to interpreters prevents the content from being unintentionally interpreted as commands. Input validation ensures accurate and correct inputs and prevents attacks such as cross-site scripting and a variety of injection attacks.


</td></tr><tr><td>Throttling</td><td>internal</td><td>6ef2450b-f6e4-4222-ab36-f8527d694634</td><td></td><td></td></tr><tr><td>Identity Evidence Validation and Verification</td><td>external</td><td>ia-12.3</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Require that the presented identity evidence be validated and verified through Auth Service.


Validation and verification of identity evidence increases the assurance that accounts and identifiers are being established for the correct user and authenticators are being bound to that user. Validation refers to the process of confirming that the evidence is genuine and authentic, and the data contained in the evidence is correct, current, and related to an individual. Verification confirms and establishes a linkage between the claimed identity and the actual existence of the user presenting the evidence. Acceptable methods for validating and verifying identity evidence are consistent with the risks to the systems, roles, and privileges associated with the users account.


</td></tr><tr><td>Restrict Inputs to Trusted Sources and Approved Formats</td><td>external</td><td>si-10.5</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Restrict the use of information inputs to verified authorized user and/or acceptable strings (avoiding special characters).


Restricting the use of inputs to trusted sources and in trusted formats applies the concept of authorized or permitted software to information inputs. Specifying known trusted sources for information inputs and acceptable formats for such inputs can reduce the probability of malicious activity. The information inputs are those defined by the organization in the base control ([SI-10](#si-10)).


</td></tr><tr><td>Information Output Filtering</td><td>external</td><td>si-15</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Validate information output from the following software programs and/or applications to ensure that the information is consistent with the expected content: Chat Service (messages, metadata in headers).


Certain types of attacks, including SQL injections, produce output results that are unexpected or inconsistent with the output results that would be expected from software programs or applications. Information output filtering focuses on detecting extraneous content, preventing such extraneous content from being displayed, and then alerting monitoring tools that anomalous behavior has been discovered.


</td></tr><tr><td>Capacity, Bandwidth, and Redundancy</td><td>external</td><td>sc-5.2</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td></td></tr><tr><td>Resource Availability</td><td>external</td><td>sc-6</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Protect the availability of resources by allocating {{ insert: param, sc-6_prm_1 }} by quota.


Priority protection prevents lower-priority processes from delaying or interfering with the system that services higher-priority processes. Quotas prevent users or processes from obtaining more than predetermined amounts of resources.


</td></tr><tr><td>Role-based Access Control (?in Secrets Vault?)</td><td>external</td><td>ac-3.7</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Enforce a role-based access control policy over defined subjects and objects and control access based upon TBD.


Role-based access control (RBAC) is an access control policy that enforces access to objects and system functions based on the defined role (i.e., job function) of the subject. Organizations can create specific roles based on job functions and the authorizations (i.e., privileges) to perform needed operations on the systems associated with the organization-defined roles. When users are assigned to specific roles, they inherit the authorizations or privileges defined for those roles. RBAC simplifies privilege administration for organizations because privileges are not assigned directly to every user (which can be a large number of individuals) but are instead acquired through role assignments. RBAC can also increase privacy and security risk if individuals assigned to a role are given access to information beyond what they need to support organizational missions or business functions. RBAC can be implemented as a mandatory or discretionary form of access control. For organizations implementing RBAC with mandatory access controls, the requirements in [AC-3(3)](#ac-3.3) define the scope of the subjects and objects covered by the policy.


</td></tr><tr><td>InternalControlExample</td><td>internal</td><td>dd424b2c-8dac-49fb-a02e-16fcfdc1bfbc</td><td></td><td></td></tr><tr><td>Role-based Access Control</td><td>external</td><td>ac-3.7</td><td>NIST Special Publication 800-53 Revision 5: Security and Privacy Controls for Federal Information Systems and Organizations</td><td>Enforce a role-based access control policy over defined subjects and objects and control access based upon TBD.


Role-based access control (RBAC) is an access control policy that enforces access to objects and system functions based on the defined role (i.e., job function) of the subject. Organizations can create specific roles based on job functions and the authorizations (i.e., privileges) to perform needed operations on the systems associated with the organization-defined roles. When users are assigned to specific roles, they inherit the authorizations or privileges defined for those roles. RBAC simplifies privilege administration for organizations because privileges are not assigned directly to every user (which can be a large number of individuals) but are instead acquired through role assignments. RBAC can also increase privacy and security risk if individuals assigned to a role are given access to information beyond what they need to support organizational missions or business functions. RBAC can be implemented as a mandatory or discretionary form of access control. For organizations implementing RBAC with mandatory access controls, the requirements in [AC-3(3)](#ac-3.3) define the scope of the subjects and objects covered by the policy.


</td></tr></tbody></table><h3>Allocations</h3><table class="table"><thead><tr><th>Control</th><th>Kind</th><th>Description</th><th>Allocated To (Component)</th><th>Source (Tag)</th><th>Catalog</th></tr></thead><tbody><tr><td>Access Enforcement</td><td>external</td><td></td><td>System</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#ac-3" target="_blank" rel="noopener">link</a></td></tr><tr><td>Separate Test Environments</td><td>external</td><td>Separate development - including of third-party add ons - environments</td><td>System</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#cm-4.1" target="_blank" rel="noopener">link</a></td></tr><tr><td>No Embedded Unencrypted Static Authenticators</td><td>external</td><td>Ensure that unencrypted static authenticators are not embedded in applications or other forms of static storage.</td><td>System</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#ia-5.7" target="_blank" rel="noopener">link</a></td></tr><tr><td>Cryptographic Protection</td><td>external</td><td></td><td>API Gateway</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#si-7.6" target="_blank" rel="noopener">link</a></td></tr><tr><td>Revocation of Access Authorizations</td><td>external</td><td>Enforce the revocation of access authorizations resulting from changes to the security attributes of subjects and objects based on TBD.


Revocation of access…</td><td>API Gateway</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#ac-3.8" target="_blank" rel="noopener">link</a></td></tr><tr><td>Session Authenticity</td><td>external</td><td>Protect the authenticity of communications sessions.</td><td>API Gateway</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#sc-23" target="_blank" rel="noopener">link</a></td></tr><tr><td>Re-authentication</td><td>external</td><td>Require users to re-authenticate when new game is created.


In addition to the re-authentication requirements associated with device locks, organizations may…</td><td>Auth Service (Identity)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#ia-11" target="_blank" rel="noopener">link</a></td></tr><tr><td>Boundary Protection</td><td>external</td><td>Monitor and control communications at the external managed interfaces to the system and at key internal managed interfaces within the system;

Implement subnet…</td><td>Game Server Cluster (real-time backend)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#sc-7" target="_blank" rel="noopener">link</a></td></tr><tr><td>Network Disconnect</td><td>external</td><td>Terminate the network connection associated with a communications session at the end of the session or after TBD seconds of inactivity.


Network disconnect a…</td><td>Game Server Cluster (real-time backend)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#sc-10" target="_blank" rel="noopener">link</a></td></tr><tr><td>Information Input Validation</td><td>external</td><td>Check the validity of the following information inputs: user input in websockets.


Checking the valid syntax and semantics of system inputs—including charact…</td><td>Game Server Cluster (real-time backend)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#si-10" target="_blank" rel="noopener">link</a></td></tr><tr><td>Throttling</td><td>internal</td><td></td><td>Chat Service (real-time)</td><td class="sidenote">internals</td><td></td></tr><tr><td>Identity Evidence Validation and Verification</td><td>external</td><td>Require that the presented identity evidence be validated and verified through Auth Service.


Validation and verification of identity evidence increases the …</td><td>Chat Service (real-time)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#ia-12.3" target="_blank" rel="noopener">link</a></td></tr><tr><td>Restrict Inputs to Trusted Sources and Approved Formats</td><td>external</td><td>Restrict the use of information inputs to verified authorized user and/or acceptable strings (avoiding special characters).


Restricting the use of inputs to…</td><td>Chat Service (real-time)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#si-10.5" target="_blank" rel="noopener">link</a></td></tr><tr><td>Information Output Filtering</td><td>external</td><td>Validate information output from the following software programs and/or applications to ensure that the information is consistent with the expected content: Ch…</td><td>Chat Service (real-time)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#si-15" target="_blank" rel="noopener">link</a></td></tr><tr><td>Capacity, Bandwidth, and Redundancy</td><td>external</td><td></td><td>Chat Service (real-time)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#sc-5.2" target="_blank" rel="noopener">link</a></td></tr><tr><td>Resource Availability</td><td>external</td><td>Protect the availability of resources by allocating {{ insert: param, sc-6_prm_1 }} by quota.


Priority protection prevents lower-priority processes from del…</td><td>Chat Service (real-time)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#sc-6" target="_blank" rel="noopener">link</a></td></tr><tr><td>Role-based Access Control (?in Secrets Vault?)</td><td>external</td><td>Enforce a role-based access control policy over defined subjects and objects and control access based upon TBD.


Role-based access control (RBAC) is an acces…</td><td>Chat Service (real-time)</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#ac-3.7" target="_blank" rel="noopener">link</a></td></tr><tr><td>InternalControlExample</td><td>internal</td><td></td><td>CDN &amp; Asset Hosting</td><td class="sidenote">internals</td><td></td></tr><tr><td>Role-based Access Control</td><td>external</td><td>Enforce a role-based access control policy over defined subjects and objects and control access based upon TBD.


Role-based access control (RBAC) is an acces…</td><td>Secrets Vault</td><td class="sidenote">externals</td><td><a href="Catalog:/CONTROL/613fca2d-704a-42e7-8e2b-b206fb92b456#ac-3.7" target="_blank" rel="noopener">link</a></td></tr></tbody></table><h3>By Component</h3><table class="table"><thead><tr><th>Component</th><th>Internal Controls</th><th>External Controls</th></tr></thead><tbody><tr><td>API Gateway</td><td></td><td><span class="badge">Cryptographic Protection</span><span class="badge">Revocation of Access Authorizations</span><span class="badge">Session Authenticity</span></td></tr><tr><td>Auth Service (Identity)</td><td></td><td><span class="badge">Re-authentication</span></td></tr><tr><td>CDN &amp; Asset Hosting</td><td><span class="badge">InternalControlExample</span></td><td></td></tr><tr><td>Chat Service (real-time)</td><td><span class="badge">Throttling</span></td><td><span class="badge">Identity Evidence Validation and Verification</span><span class="badge">Restrict Inputs to Trusted Sources and Approved Formats</span><span class="badge">Information Output Filtering</span><span class="badge">Capacity, Bandwidth, and Redundancy</span><span class="badge">Resource Availability</span><span class="badge">Role-based Access Control (?in Secrets Vault?)</span></td></tr><tr><td>Game Server Cluster (real-time backend)</td><td></td><td><span class="badge">Boundary Protection</span><span class="badge">Network Disconnect</span><span class="badge">Information Input Validation</span></td></tr><tr><td>Secrets Vault</td><td></td><td><span class="badge">Role-based Access Control</span></td></tr><tr><td>System</td><td></td><td><span class="badge">Access Enforcement</span><span class="badge">Separate Test Environments</span><span class="badge">No Embedded Unencrypted Static Authenticators</span></td></tr></tbody></table></section></div></div>
<script>
(function(){
  'use strict';
  function $(sel, root){return (root||document).querySelector(sel)}
  function textEsc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
  function trunc(s, n){ s = String(s||''); return s.length>n? s.slice(0,n-1)+'…' : s; }
  var statusEl = document.getElementById('status');
  var fileEl = document.getElementById('fileInput');
  var parseBtn = document.getElementById('parseBtn');
  var dlBtn = document.getElementById('downloadBtn');
  var reportEl = document.getElementById('report');
  var fileText = '';
  fileEl.addEventListener('change', function(){
    var f = fileEl.files && fileEl.files[0];
    if(!f){ statusEl.textContent=''; parseBtn.disabled=true; return; }
    var reader = new FileReader();
    reader.onload = function(e){ fileText = String(e.target.result||''); statusEl.textContent = f.name + ' loaded (' + f.size + ' bytes)'; parseBtn.disabled = false; };
    reader.onerror = function(){ statusEl.textContent = 'Failed to read file'; parseBtn.disabled=true; };
    reader.readAsText(f);
  });
  dlBtn.addEventListener('click', function(){
    var html = '<!DOCTYPE html>' + document.documentElement.outerHTML;
    var blob = new Blob([html], {type:'text/html'});
    var a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'trades_report.html'; a.click(); URL.revokeObjectURL(a.href);
  });
  parseBtn.addEventListener('click', function(){ if(!fileText){return} try{ generateReport(fileText); dlBtn.disabled=false; }catch(err){ console.error(err); alert('Parse error: ' + err.message); }});

  function localName(node){ if(!node || !node.tagName) return ''; var t=node.tagName; var i=t.indexOf(':'); return i>=0? t.slice(i+1): t; }
  function parseXML(text){ var clean=String(text||'').replace(/^[\uFEFF\u200B]+/, ''); var dom=new DOMParser().parseFromString(clean, 'application/xml'); var err=dom.querySelector('parsererror'); if(err) throw new Error('XML parser error: ' + err.textContent.replace(/\s+/g,' ').slice(0,200)); return dom; }

  function buildEmfPathMap(root){
    var map = new Map();
    function walk(node, stack){
      var childGroups = Object.create(null);
      for(var i=0;i<node.children.length;i++){
        var ch = node.children[i];
        var feat = localName(ch);
        var idx = (childGroups[feat]||0); childGroups[feat]=idx+1;
        var seg = '@' + feat + '.' + idx;
        var cur = stack.concat([seg]);
        var key = '//' + cur.join('/');
        var nm = ch.getAttribute('name') || '';
        map.set(key, {name:nm, tag: feat, el: ch});
        walk(ch, cur);
      }
    }
    walk(root.documentElement, []);
    return map;
  }
  function num(v){ var n = Number(v); return isFinite(n) ? n : null; }
  function parseIndexFromRef(ref, feature){ if(!ref) return null; var pos = ref.indexOf(feature + '.'); if(pos < 0) return null; var tail = ref.slice(pos + feature.length + 1); var m = /^(\d+)/.exec(tail); return m? Number(m[1]) : null; }
  function getFirstText(el, tagNames){
    for(var i=0;i<tagNames.length;i++){
      var t = tagNames[i];
      var found = el.getElementsByTagName(t);
      if(found && found.length){ var n = found[0]; var txt = n.getAttribute('name') || n.textContent; if(txt) return txt; }
    }
    return '';
  }
  // Resolve data refs list
  function resolveDataRefList(value, emf){
    if(!value) return {names: '', raw: ''};
    var tokens = String(value).split(/[\s,;]+/).filter(Boolean);
    var names = [];
    for(var i=0;i<tokens.length;i++){
      var tok = tokens[i];
      var entry = emf.get(tok);
      if(entry && entry.name){ names.push(entry.name); continue; }
      var h = tok.indexOf('#');
      if(h>=0){ var tail = tok.slice(h+1); var e2 = emf.get(tail); if(e2 && e2.name){ names.push(e2.name); continue; } }
      if(tok.indexOf('/@')<0){ names.push(tok); continue; }
      var m = /@([^\/]+)\.(\d+)$/.exec(tok);
      if(m){ for (var it of emf.keys()){ if(it.endsWith('@'+m[1]+'.'+m[2])){ var ent = emf.get(it); names.push(ent && ent.name ? ent.name : tok); break; } } continue; }
      names.push(tok);
    }
    var seen = Object.create(null); var out=[];
    for(var j=0;j<names.length;j++){ var nm = names[j]; var key = nm.toLowerCase(); if(!seen[key]){ seen[key]=1; out.push(nm); } }
    return {names: out.join(', '), raw: value};
  }

  function extract(root){
    var emf = buildEmfPathMap(root);
    var byPath = function(ref){ var e = ref && emf.get(ref); return e ? (e.name || ref) : (ref || ''); };

    // Scores
    var impactScores = Array.prototype.map.call(root.getElementsByTagName('impactScores'), function(el){ return { name: el.getAttribute('name')||'', impact: num(el.getAttribute('impact')||'') }; });
    var difficultyScores = Array.prototype.map.call(root.getElementsByTagName('difficultyScores'), function(el){ return { name: el.getAttribute('name')||'', difficulty: num(el.getAttribute('difficulty')||'') }; });

    // Threats & Threat Allocations (keep original behavior including internals/externals)
    var threatInternals = [];
    var threatExternals = [];
    Array.prototype.forEach.call(root.getElementsByTagName('threatOwner'), function(owner){
      Array.prototype.forEach.call(owner.getElementsByTagName('internals'), function(intEl){ if(intEl.hasAttribute('name')) threatInternals.push(intEl.getAttribute('name')); });
      Array.prototype.forEach.call(owner.getElementsByTagName('externals'), function(extEl){ if(extEl.hasAttribute('name')) threatExternals.push(extEl.getAttribute('name')); });
    });
    // duplicate loop preserved from original
    Array.prototype.forEach.call(root.getElementsByTagName('threatOwner'), function(owner){ Array.prototype.forEach.call(owner.getElementsByTagName('internals'), function(intEl){ if(intEl.hasAttribute('name')) threatInternals.push(intEl.getAttribute('name')); }); });

    var allocRows = [];
    Array.prototype.forEach.call(root.getElementsByTagName('threatAllocations'), function(ta){
      var thRef = ta.getAttribute('threat'); var impRef = ta.getAttribute('impactScore'); var difRef = ta.getAttribute('difficultyScore');
      var allocName = ta.getAttribute('name') || '';
      var thName='';
      var thIdx=parseIndexFromRef(thRef||'', 'internals'); if(thIdx!=null && threatInternals[thIdx]) thName = threatInternals[thIdx];
      var thEIdx=parseIndexFromRef(thRef||'', 'externals'); if(!thName && thEIdx!=null && threatExternals[thEIdx]) thName = threatExternals[thEIdx];
      if(!thName) thName = byPath(thRef);
      var impLevel=null,impLabel=''; var iIdx=parseIndexFromRef(impRef||'', 'impactScores'); if(iIdx!=null && impactScores[iIdx]){ impLevel=impactScores[iIdx].impact; impLabel=impactScores[iIdx].name; }
      var difLevel=null,difLabel=''; var dIdx=parseIndexFromRef(difRef||'', 'difficultyScores'); if(dIdx!=null && difficultyScores[dIdx]){ difLevel=difficultyScores[dIdx].difficulty; difLabel=difficultyScores[dIdx].name; }
      var compNode = ta.parentElement; var compName = '';
      while(compNode && localName(compNode) !== 'components') compNode = compNode.parentElement;
      if(compNode) compName = compNode.getAttribute('name') || '';
      var newLabel = (allocName || (thName || '(allocation)')) + ' on ' + (compName || '(unknown)');
      allocRows.push({ allocName: allocName || (thName || '(allocation)'), threat: thName || '(unknown threat)', compName: compName, displayName: newLabel, impact: impLevel, impactLabel: impLabel, difficulty: difLevel, difficultyLabel: difLabel });
    });

    // Components & controls
    function buildTreeAndControls(node){
      var out=[];
      for(var i=0;i<node.children.length;i++){
        var ch=node.children[i]; var ln=localName(ch);
        if(ln==='components'){
          var name=ch.getAttribute('name')||'(unnamed)';
          var compControls=[];
          for(var j=0;j<ch.children.length;j++){
            var sub=ch.children[j]; if(localName(sub)!=='controlOwner') continue;
            for(var k=0;k<sub.children.length;k++){
              var ctrl=sub.children[k]; var tag=localName(ctrl);
              if(tag!=='internals' && tag!=='externals') continue;
              var kind = (tag==='externals') ? 'external' : 'internal';
              var ctrlName = ctrl.getAttribute('name')||''; if(!ctrlName) continue;
              var item={
                id: ctrl.getAttribute('id')||ctrl.getAttribute('uid')||ctrl.getAttribute('xmi:id')||'',
                name: ctrlName,
                description: ctrl.getAttribute('description') || ctrl.getAttribute('desc') || ctrl.getAttribute('tooltipText') || getFirstText(ctrl, ['description','comment','notes','text','doc','documentation']) || '',
                kind: kind,
                source: ctrl.getAttribute('source')||'',
                link: ctrl.getAttribute('link')||'',
                sourceID: ctrl.getAttribute('sourceID')||'',
                rawTag: tag,
                component: name,
                characteristics: Array.prototype.map.call(ctrl.getElementsByTagName('characteristics'), function(c){ return {name:c.getAttribute('name')||'', label:c.getAttribute('label')||'', value:c.getAttribute('value')||''}; })
              };
              compControls.push(item);
            }
          }
          var children = buildTreeAndControls(ch);
          out.push({ name:name, children:children, controls:compControls });
        }
      }
      return out;
    }
    var componentRoots = buildTreeAndControls(root.documentElement);

    // Flatten to catalog + allocations
    var controlsCatalogMap = Object.create(null);
    var controlAllocs=[];
    function walkCompTree(n){
      if(n.controls && n.controls.length){
        for(var i=0;i<n.controls.length;i++){
          var c=n.controls[i];
          var key=(c.kind||'internal')+'\n'+(c.id||'')+'\n'+c.name.toLowerCase();
          if(!controlsCatalogMap[key]) controlsCatalogMap[key] = {name:c.name, description:c.description, kind:c.kind, id:c.id, source:c.source, link:c.link, sourceID:c.sourceID};
          controlAllocs.push({ control:c.name, description:c.description, kind:c.kind, where:n.name, rawTag:c.rawTag, source:c.source, link:c.link, sourceID:c.sourceID });
        }
      }
      (n.children||[]).forEach(walkCompTree);
    }
    componentRoots.forEach(walkCompTree);
    var controlsCatalog = Object.keys(controlsCatalogMap).map(function(k){ return controlsCatalogMap[k]; });

    // Per-component rollup
    var byComponent = {};
    controlAllocs.forEach(function(a){ var key=a.where||'(unresolved)'; if(!byComponent[key]) byComponent[key]={ internal:[], external:[] }; byComponent[key][a.kind==='external'?'external':'internal'].push(a); });

    // Data Flows (Affect Relations)
    var affects = Array.prototype.map.call(root.getElementsByTagName('affectRelations'), function(el){
      var raw = el.getAttribute('data')||''; var r = resolveDataRefList(raw, emf);
      return { link: byPath(el.getAttribute('link')), target: byPath(el.getAttribute('targetComponent')), data: r.names, rawData: r.raw };
    });

    // === Eclipse-derived risk-matrix colors (from version 8) ===
    var cellColors = {};
    Array.prototype.forEach.call(root.getElementsByTagName('impactScores'), function(isEl){
      var impLevel = num(isEl.getAttribute('impact'));
      if(!impLevel) return;
      if(!cellColors[impLevel]) cellColors[impLevel] = {};
      Array.prototype.forEach.call(isEl.getElementsByTagName('configurations'), function(cfg){
        var diffRef = cfg.getAttribute('difficulty')||'';
        var dIdx = parseIndexFromRef(diffRef, 'difficultyScores');
        if(dIdx==null) return;
        var diffLevel = dIdx + 1; // index-based level (as in v8)
        var col = cfg.getAttribute('color')||'';
        var n = Number(col);
        if(Number.isFinite(n)){
          var css = '#' + n.toString(16).padStart(6,'0');
          cellColors[impLevel][diffLevel] = css;
        } else if(/^\#?[0-9a-fA-F]{6}$/.test(col)){
          var css2 = col.startsWith('#') ? col : ('#'+col);
          cellColors[impLevel][diffLevel] = css2;
        }
      });
    });

    return { impactScores:impactScores, difficultyScores:difficultyScores, allocRows:allocRows, componentRoots:componentRoots, affects:affects, controls:controlsCatalog, controlAllocs:controlAllocs, byComponent:byComponent, cellColors:cellColors };
  }

  function renderTree(nodes){ var ul=document.createElement('ul'); ul.className='tree'; nodes.forEach(function(n){ var li=document.createElement('li'); li.innerHTML='<strong>'+textEsc(n.name)+'</strong>'; if(n.controls && n.controls.length){ var sub=document.createElement('div'); sub.className='sidenote'; var badges=n.controls.map(function(c){return '<span class="badge">'+textEsc(c.name)+' ('+(c.kind||'internal')+')</span>';}).join(' '); sub.innerHTML='Controls: '+badges; li.appendChild(sub);} if(n.children && n.children.length) li.appendChild(renderTree(n.children)); ul.appendChild(li); }); return ul; }

  function cellColor(i,d){ var s=(i||0)+(d||0); if(s<=3) return 'var(--green)'; if(s<=4) return 'var(--yellow)'; if(s<=5) return 'var(--orange)'; return 'var(--red)'; }

  function generateReport(xmi){
    var xml = parseXML(xmi); var data = extract(xml); var wrap = document.createElement('div');

    // Summary
    var meta=document.createElement('section'); var fname=(fileEl.files&&fileEl.files[0])?fileEl.files[0].name:''; var fsize=(fileEl.files&&fileEl.files[0])?fileEl.files[0].size:0;
    meta.innerHTML='<h2>File Summary</h2><ul><li><strong>Name</strong>: '+textEsc(fname)+'</li><li><strong>Size</strong>: '+fsize+' bytes</li></ul><p class="note">If some sections appear empty, the XMI may not include those elements or uses a different mapping. Export the <em>.trades</em> with full semantic content.</p>';
    wrap.appendChild(meta);

    // Risks
    var risksSec=document.createElement('section'); risksSec.innerHTML='<h2>Identified Risks (Threat Allocations)</h2>';
    if(data.allocRows.length){ var tbl=document.createElement('table'); tbl.className='table'; tbl.innerHTML='<thead><tr><th>Threat Allocation</th><th>Impact</th><th>Feasibility</th></tr></thead>'; var tb=document.createElement('tbody'); data.allocRows.forEach(function(r){ var tr=document.createElement('tr'); tr.innerHTML='<td>'+textEsc(r.displayName)+'</td><td>'+(r.impact!=null?r.impact:'')+(r.impactLabel?' ('+textEsc(r.impactLabel)+')':'')+'</td><td>'+(r.difficulty!=null?r.difficulty:'')+(r.difficultyLabel?' ('+textEsc(r.difficultyLabel)+')':'')+'</td>'; tb.appendChild(tr); }); tbl.appendChild(tb); risksSec.appendChild(tbl);} else { risksSec.innerHTML+='<p>No threat allocations found.</p>'; }
    wrap.appendChild(risksSec);

    // Impact Items
    var impSec=document.createElement('section'); impSec.innerHTML='<h2>Impact Items</h2>';
    if(data.impactScores.length){ var it=document.createElement('table'); it.className='table'; it.innerHTML='<thead><tr><th>Level</th><th>Description</th></tr></thead>'; var ib=document.createElement('tbody'); data.impactScores.forEach(function(s){ var tr=document.createElement('tr'); tr.innerHTML='<td>'+(s.impact!=null?s.impact:'')+'</td><td>'+textEsc(s.name)+'</td>'; ib.appendChild(tr); }); it.appendChild(ib); impSec.appendChild(it);} else { impSec.innerHTML+='<p>None found.</p>'; }
    wrap.appendChild(impSec);

    // ====== Variable-sized Risk Matrix (N x M) ======
    var matSec=document.createElement('section'); matSec.innerHTML='<h2>Risk Matrix (Impact vs Feasibility)</h2>'; var mat=document.createElement('table'); mat.className='matrix';

    var maxI = 0; for(var u=0; u<data.impactScores.length; u++){ var v = Math.round(data.impactScores[u].impact||0); if(v>maxI) maxI=v; }
    if(maxI<=0) maxI = 3; // safe fallback
    var maxD = data.difficultyScores.length || 3;

    function labelForImpact(i){ for(var x=0;x<data.impactScores.length;x++){ var s=data.impactScores[x]; if(Math.round(s.impact||0)===i) return s.name||String(i); } return String(i); }
    function labelForDiff(d){ var s=data.difficultyScores[d-1]; return s? (s.name||String(d)) : String(d); }

    var head=document.createElement('thead'); var trh=document.createElement('tr'); trh.innerHTML='<th></th>';
    for(var d=1; d<=maxD; d++){ trh.innerHTML+='<th>Feasibility '+d+' ('+textEsc(labelForDiff(d))+')</th>'; }
    head.appendChild(trh); mat.appendChild(head);

    var body=document.createElement('tbody'); var buckets=Object.create(null);
    data.allocRows.forEach(function(r){
      var i=Math.max(1,Math.min(maxI,Math.round(r.impact||0)));
      var d=Math.max(1,Math.min(maxD,Math.round(r.difficulty||0)));
      var key=i+','+d; (buckets[key]||(buckets[key]=[])).push(r.displayName);
    });

    for(var i=1;i<=maxI;i++){
      var tr=document.createElement('tr'); tr.innerHTML='<th>Impact '+i+' ('+textEsc(labelForImpact(i))+')</th>';
      for(var d=1; d<=maxD; d++){
        var key=i+','+d; var names=buckets[key]||[]; var chips=names.map(function(n){return '<span class="badge">'+textEsc(n)+'</span>';}).join('');
        var td=document.createElement('td'); td.style.background = (data.cellColors && data.cellColors[i] && data.cellColors[i][d]) ? data.cellColors[i][d] : cellColor(i,d); td.innerHTML=chips; tr.appendChild(td);
      }
      body.appendChild(tr);
    }
    mat.appendChild(body); matSec.appendChild(mat);
    matSec.innerHTML+='<p class="sidenote">Matrix size adapts to your scoring system: Impact levels 1…'+maxI+' × Feasibility levels 1…'+maxD+'. Model-defined colors override the fallback gradient.</p>';
    wrap.appendChild(matSec);

    // System Architecture
    var archSec=document.createElement('section'); archSec.innerHTML='<h2>System Architecture</h2>'; if(data.componentRoots.length){ archSec.appendChild(renderTree(data.componentRoots)); } else { archSec.innerHTML+='<p>No components found.</p>'; } wrap.appendChild(archSec);

    // Data Flows
    if(data.affects.length){ var at=document.createElement('section'); at.innerHTML='<h2>Data Flows</h2>'; var tbl2=document.createElement('table'); tbl2.className='table'; tbl2.innerHTML='<thead><tr><th>Link</th><th>Target Component</th><th>Data Refs</th></tr></thead>'; var ab=document.createElement('tbody'); data.affects.forEach(function(a){ var tr=document.createElement('tr'); var cell = '<td>'+textEsc(a.data); if(a.rawData && a.rawData!==a.data){ cell += ' <span class="sidenote">('+textEsc(a.rawData)+')</span>'; } cell += '</td>'; tr.innerHTML='<td>'+textEsc(a.link)+'</td><td>'+textEsc(a.target)+'</td>'+cell; ab.appendChild(tr); }); tbl2.appendChild(ab); at.appendChild(tbl2); wrap.appendChild(at); }

    // Security Controls
    var scSec=document.createElement('section'); scSec.innerHTML='<h2>Allocated Security Controls</h2>';
    if(data.controls.length){ var ct=document.createElement('table'); ct.className='table'; ct.innerHTML='<thead><tr><th>Control</th><th>Kind</th><th>ID</th><th>Source</th><th>Description</th></tr></thead>'; var cb=document.createElement('tbody'); data.controls.forEach(function(c){ var tr=document.createElement('tr'); tr.innerHTML='<td>'+textEsc(c.name)+'</td><td>'+(c.kind||'internal')+'</td><td>'+textEsc(c.id||'')+'</td><td>'+textEsc(c.source||'')+'</td><td>'+textEsc(c.description||'')+'</td>'; cb.appendChild(tr); }); ct.appendChild(cb); scSec.appendChild(document.createElement('h3')).textContent='Catalog'; scSec.appendChild(ct);} else { scSec.innerHTML+='<p>No controls catalog found (internal/external).</p>'; }
    if(data.controlAllocs.length){ var at2=document.createElement('table'); at2.className='table'; at2.innerHTML='<thead><tr><th>Control</th><th>Kind</th><th>Description</th><th>Allocated To (Component)</th><th>Source (Tag)</th><th>Catalog</th></tr></thead>'; var ab2=document.createElement('tbody'); data.controlAllocs.forEach(function(a){ var link = a.link? '<a href="'+textEsc(a.link)+'" target="_blank" rel="noopener">link</a>' : ''; var tr=document.createElement('tr'); tr.innerHTML='<td>'+textEsc(a.control)+'</td><td>'+textEsc(a.kind||'internal')+'</td><td>'+textEsc(trunc(a.description,160))+'</td><td>'+textEsc(a.where||'')+'</td><td class="sidenote">'+textEsc(a.rawTag)+'</td><td>'+link+'</td>'; ab2.appendChild(tr); }); at2.appendChild(ab2); scSec.appendChild(document.createElement('h3')).textContent='Allocations'; scSec.appendChild(at2);
      var pc=document.createElement('table'); pc.className='table'; pc.innerHTML='<thead><tr><th>Component</th><th>Internal Controls</th><th>External Controls</th></tr></thead>'; var pcb=document.createElement('tbody'); Object.keys(data.byComponent).sort().forEach(function(comp){ var row=data.byComponent[comp]; var iList=(row.internal||[]).map(function(a){return '<span class="badge">'+textEsc(a.control)+'</span>';}).join(''); var eList=(row.external||[]).map(function(a){return '<span class="badge">'+textEsc(a.control)+'</span>';}).join(''); var tr=document.createElement('tr'); tr.innerHTML='<td>'+textEsc(comp)+'</td><td>'+iList+'</td><td>'+eList+'</td>'; pcb.appendChild(tr); }); pc.appendChild(pcb); scSec.appendChild(document.createElement('h3')).textContent='By Component'; scSec.appendChild(pc);
    } else { scSec.innerHTML+='<p>No control allocations detected under components. Confirm controls are placed under <code><controlOwner></code> using <code><internals></code> or <code><externals></code>.</p>'; }
    wrap.appendChild(scSec);

    reportEl.innerHTML=''; reportEl.appendChild(wrap);
  }
})();
</script>


</body></html>